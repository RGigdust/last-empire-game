<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LAST Empire | Emoji Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; background: #050505; overflow: hidden; }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            backgroundColor: '#050505',
            parent: 'game-container',
            physics: { default: 'arcade' },
            scene: { create: create, update: update }
        };

        const game = new Phaser.Game(config);
        let lion, scoreText, balance = 0, distance = 0;
        let lastPos = { x: 0, y: 0 };

        function create() {
            // Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø¯ ÙƒØ±Ù…Ø² (Emoji)
            lion = this.add.text(window.innerWidth/2, window.innerHeight/2, 'ðŸ¦', { fontSize: '60px' });
            this.physics.add.existing(lion);
            lion.body.setCollideWorldBounds(true);

            // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±ØµÙŠØ¯
            scoreText = this.add.text(20, 40, `ðŸ’° $LAST: 0`, {
                fontSize: '32px', fill: '#ffd700', fontWeight: 'bold'
            });

            lastPos = { x: lion.x, y: lion.y };

            // Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³
            this.input.on('pointermove', (pointer) => {
                this.physics.moveToObject(lion, pointer, 250);
            });
        }

        function update() {
            let d = Phaser.Math.Distance.Between(lion.x, lion.y, lastPos.x, lastPos.y);
            if (d > 2) {
                distance += d;
                lastPos = { x: lion.x, y: lion.y };

                if (distance >= 800) { // Ø³Ø±Ø¹Ù†Ø§ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø´ÙˆÙŠØ©
                    balance += 1;playSound('coin');
                    distance = 0;
                    scoreText.setText(`ðŸ’° $LAST: ${balance}`);
                    
                    // ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ø¹Ù†Ø¯ ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø© (Ø§ÙØªÙƒØ§Ø³Ø©)
                    showGainEffect(this, lion.x, lion.y);
                    
                    tg.HapticFeedback.impactOccurred('medium');
                }
            }
        }

        function showGainEffect(scene, x, y) {
            let flyCoin = scene.add.text(x, y, '+1 ðŸ’°', { fontSize: '20px', fill: '#ffd700' });
            scene.tweens.add({
                targets: flyCoin,
                y: y - 100,
                alpha: 0,
                duration: 800,
                onComplete: () => flyCoin.destroy()
            });
      
function playSound(type) {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);

    if (type === 'coin') {
        // ØµÙˆØª "Ø±Ù†Ø©" Ø§Ù„Ø¹Ù…Ù„Ø©
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
    } else if (type === 'roar') {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø²Ø¦ÙŠØ± (ØµÙˆØª Ø®Ø´Ù† Ø´ÙˆÙŠØ©)
        oscillator.type = 'sawtooth';
        oscillator.frequency.setValueAtTime(100, audioCtx.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.5);
        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
    }

    oscillator.start();
    oscillator.stop(audioCtx.currentTime + (type === 'coin' ? 0.1 : 0.5));
}

      
        }
    </script>
</body>
</html>

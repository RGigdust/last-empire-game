<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LAST Empire | Ø§Ù„Ù…Ù„Ø­Ù…Ø©</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Arial', sans-serif; }
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© - Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù„ÙŠ Ø¨ØªÙ‚ÙˆÙ„ Ø¹Ù„ÙŠÙ‡ */
        .bottom-menu {
            position: fixed; bottom: 0; width: 100%; height: 70px;
            background: rgba(20, 20, 20, 0.9); display: flex;
            justify-content: space-around; align-items: center;
            border-top: 2px solid #ffd700; z-index: 10;
        }
        .menu-item { color: #fff; text-align: center; font-size: 12px; filter: grayscale(1); }
        .menu-item.active { filter: grayscale(0); color: #ffd700; }
    </style>
</head>
<body>

    <div id="game-container"></div>

    <div class="bottom-menu">
        <div class="menu-item active">ğŸ¦<br>Ø§Ù„Ø¹Ø±ÙŠÙ†</div>
        <div class="menu-item">âš’ï¸<br>ØªØ·ÙˆÙŠØ±</div>
        <div class="menu-item">ğŸ“œ<br>Ù…Ù‡Ø§Ù…</div>
        <div class="menu-item">ğŸ‘¥<br>Ø§Ù„Ù‚Ø¨ÙŠÙ„Ø©</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙØ¸ (Local Storage) Ø¹Ø´Ø§Ù† Ù…Ø¬Ù‡ÙˆØ¯Ùƒ Ù…ÙŠØ±ÙˆØ­Ø´
        let balance = parseInt(localStorage.getItem('last_balance')) || 0;

        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight - 70, // Ù†Ø³ÙŠØ¨ Ù…ÙƒØ§Ù† Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
            backgroundColor: '#0a0a0a',
            parent: 'game-container',
            physics: { default: 'arcade' },
            scene: { create: create, update: update }
        };

        const game = new Phaser.Game(config);
        let lion, scoreText, distance = 0, lastPos = {x:0, y:0};

        function create() {
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ø¯
            lion = this.add.text(window.innerWidth/2, window.innerHeight/2, 'ğŸ¦', { fontSize: '80px' });
            this.physics.add.existing(lion);
            lion.body.setCollideWorldBounds(true);

            // Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø¨Ø´ÙƒÙ„ Ø£Ø´ÙŠÙƒ
            scoreText = this.add.text(20, 30, `ğŸ’° $LAST: ${balance}`, {
                fontSize: '35px', fill: '#ffd700', fontWeight: 'bold'
            });

            lastPos = { x: lion.x, y: lion.y };

            // Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙˆÙ‚ÙˆÙ: Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ø³ØªÙ…Ø±Ø© Ù…Ø¹ Ø§Ù„Ù„Ù…Ø³
            this.input.on('pointermove', (pointer) => {
                this.physics.moveToObject(lion, pointer, 300);
            });
        }

        function update() {
            let d = Phaser.Math.Distance.Between(lion.x, lion.y, lastPos.x, lastPos.y);
            if (d > 1) {
                distance += d;
                lastPos = { x: lion.x, y: lion.y };

                if (distance >= 700) {
                    balance += 1;
                    distance = 0;
                    scoreText.setText(`ğŸ’° $LAST: ${balance}`);
                    
                    // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ
                    localStorage.setItem('last_balance', balance);
                    
                    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ø§Ù‡ØªØ²Ø§Ø²
                    playCoinSound();
                    tg.HapticFeedback.impactOccurred('medium');
                }
            }
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø³Ù†Ø© (ØªØ¹Ù…Ù„ Ù…Ø¹ Ø£ÙˆÙ„ Ù„Ù…Ø³Ø©)
        function playCoinSound() {
            try {
                const context = new (window.AudioContext || window.webkitAudioContext)();
                const osc = context.createOscillator();
                const g = context.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(900, context.currentTime);
                g.gain.setValueAtTime(0.1, context.currentTime);
                osc.connect(g);
                g.connect(context.destination);
                osc.start();
                osc.stop(context.currentTime + 0.1);
            } catch(e) { console.log("Ø§Ù„ØµÙˆØª Ù…Ø­ØªØ§Ø¬ Ø¯ÙˆØ³Ø© Ø´Ø§Ø´Ø©"); }
        }
    </script>
</body>
</html>
